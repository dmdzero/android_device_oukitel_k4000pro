From 54d7646105a7684836a57deee53770c8e4a84b12 Mon Sep 17 00:00:00 2001
From: olegsvs <oleg.texet@gmail.com>
Date: Tue, 22 Nov 2016 13:53:40 +0000
Subject: [PATCH] mtk6735

---
 .../android/settings/sim/MultiSimEnablerPreference.java | 17 +++++++++++++++++
 1 file changed, 17 insertions(+)

diff --git a/src/com/android/settings/sim/MultiSimEnablerPreference.java b/src/com/android/settings/sim/MultiSimEnablerPreference.java
index a09de53..7c6e9dd 100644
--- a/src/com/android/settings/sim/MultiSimEnablerPreference.java
+++ b/src/com/android/settings/sim/MultiSimEnablerPreference.java
@@ -31,6 +31,9 @@
 
 package com.android.settings.sim;
 
+import android.os.RemoteException;
+import android.os.ServiceManager;
+import com.android.internal.telephony.ITelephony;
 import android.app.AlertDialog;
 import android.app.Dialog;
 import android.app.ProgressDialog;
@@ -104,11 +107,13 @@ public class MultiSimEnablerPreference extends Preference implements OnCheckedCh
             TelephonyIntents.ACTION_SUBINFO_CONTENT_CHANGE);
 
     private SubscriptionManager mSubscriptionManager;
+    private ITelephony mITelephony;
 
     public MultiSimEnablerPreference(Context context, AttributeSet attrs, int defStyle) {
         super(context, attrs, defStyle);
         mContext = context;
         mSubscriptionManager = SubscriptionManager.from(context);
+        mITelephony = ITelephony.Stub.asInterface(ServiceManager.getService(Context.TELEPHONY_SERVICE));
         setWidgetLayoutResource(R.layout.custom_checkbox);
         setSwitchVisibility(View.VISIBLE);
     }
@@ -123,6 +128,17 @@ public class MultiSimEnablerPreference extends Preference implements OnCheckedCh
         mSubscriptionManager = SubscriptionManager.from(context);
     }
 
+    private void setRadioStateForSpecificSIM(boolean checked, int subscriberID) {
+   	if(subscriberID != SubscriptionManager.INVALID_SUBSCRIPTION_ID) {
+		try {
+			mITelephony.setRadioForSubscriber(subscriberID, checked);
+		}
+		catch (RemoteException re) {
+			re.printStackTrace();
+		  }
+	   }
+    }
+
     private void sendMessage(int event, Handler handler, int delay) {
         Message message = handler.obtainMessage(event);
         handler.sendMessageDelayed(message, delay);
@@ -306,6 +322,7 @@ public class MultiSimEnablerPreference extends Preference implements OnCheckedCh
 
         showProgressDialog();
         mSwitch.setEnabled(false);
+        setRadioStateForSpecificSIM(true, mSir.getSubscriptionId());
         if (mCurrentState) {
             SubscriptionManager.activateSubId(mSir.getSubscriptionId());
         } else {
-- 
1.9.1

